<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pet Registration Form</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
  </head>
  <body>
    <form id="registrationForm">
      <div class="form-group">
        <label for="exampleInputEmail1">Email address</label>
        <input
          type="email"
          class="form-control"
          id="exampleInputEmail1"
          aria-describedby="emailHelp"
          placeholder="Enter email"
        />
      </div>
      <div class="form-group">
        <label for="exampleInputPassword1">Password</label>
        <input
          type="password"
          class="form-control"
          id="exampleInputPassword1"
          placeholder="Password"
        />
      </div>

      <div id="petFields">
        <!-- Pet fields will be dynamically added here -->
      </div>

      <button type="button" class="btn btn-primary" id="addPetBtn">
        Add Pet
      </button>

      <button type="button" class="btn btn-primary" id="submitBtn">
        Submit
      </button>
    </form>

    <div id="successPage" style="display: none">
      <h2>Form Submitted Successfully!</h2>
      <p>Thank you for your submission.</p>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script>
      // JavaScript to handle adding and submitting pets
      const form = document.getElementById("registrationForm");
      const addPetBtn = document.getElementById("addPetBtn");
      const submitBtn = document.getElementById("submitBtn");
      const petFields = document.getElementById("petFields");
      const successPage = document.getElementById("successPage");

      // Counter for tracking the number of added pets
      let petCounter = 0;

      // Function to add input fields for a pet
      function addPetFields() {
        petCounter++;
        const petFieldDiv = document.createElement("div");
        petFieldDiv.innerHTML = `
                      <h4>Pet ${petCounter}</h4>
                      <div class="form-group">
                        <label for="petSpecies${petCounter}">Pet Species</label>
                        <input
                          type="text"
                          class="form-control"
                          id="petSpecies${petCounter}"
                          placeholder="Species"
                        />
                      </div>
                      <div class="form-group">
                        <label for="petName${petCounter}">Pet Name</label>
                        <input
                          type="text"
                          class="form-control"
                          id="petName${petCounter}"
                          placeholder="Name"
                        />
                      </div>
                      <div class="form-group">
                        <label for="petAge${petCounter}">Pet Age</label>
                        <input
                          type="number"
                          class="form-control"
                          id="petAge${petCounter}"
                          placeholder="Age"
                        />
                      </div>
                    `;
        petFields.appendChild(petFieldDiv);
      }

      // Add pet fields when the "Add Pet" button is clicked
      addPetBtn.addEventListener("click", addPetFields);

      async function submitForm() {
        const email = document.getElementById("exampleInputEmail1").value;
        const userData = {
          email: email,
          password: document.getElementById("exampleInputPassword1").value,
        };

        const petData = [];
        for (let i = 1; i <= petCounter; i++) {
          const species = document.getElementById(`petSpecies${i}`).value;
          const name = document.getElementById(`petName${i}`).value;
          const age = document.getElementById(`petAge${i}`).value;
          const owner = email;
          petData.push({ owner, species, name, age });
        }

        const requestBody = {
          user: userData,
          pets: petData,
        };
        const response = await fetch("/register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(requestBody),
        });

        if (response.status === 200) {
          const redirectURL = "/user?email=" + encodeURIComponent(email)
          window.location.href = redirectURL;
        } else {
          // Handle the error response
          const error = await response.json();
          console.error("Error:", error);
        }
      }


      submitBtn.addEventListener("click", submitForm);
    </script>
  </body>
</html>
